<link rel="stylesheet" type="text/css" href="/assets/css/custom/common.css"/>
<style type="text/css">
    .layui-form-label {
        width: 120px;
        padding: 9px 0;
    }

    .layui-input-block {
        margin-left: 130px;
    }


    /*.xm-form-selected .xm-select, .xm-form-selected .xm-select:hover {*/
    /*    border-color: #e6e6e6 !important;*/
    /*}*/
    verify
        /*textarea {*/
        /*    width: 100%;*/
        /*    border: 1px solid #e6e6e6 !important;*/
        /*    background: #fff !important;*/
        /*}*/
    .input_gray {
        background: #f5f5f5;
    }

    .danwei {
        width: 40px;
        position: absolute;
        right: -49px;
        text-align: left;
        top: 10px;
    }
</style>
<form id="contract_change_check_form" lay-filter="contract_change_check_form" class="layui-form model-form">

    <fieldset class="layui-elem-field layui-field-title">
        <legend>合同信息</legend>
    </fieldset>
    <div class="layui-form-item">
        <input id="id" name="id" type="hidden"/>
        <input name="checkTime" id="checkTime" type="hidden"/>
        <input name="checkUserId" id="checkUserId" type="hidden"/>
        <!--合同ID-->
        <div class="layui-inline">
            <label class="layui-form-label">合同编号</label>
            <div class="layui-input-block">

                <input id="contractId" type="text" name="contractId" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
        </div>
        <!--合同年份-->
        <div class="layui-inline">
            <label class="layui-form-label">合同类型</label>
            <div class="layui-input-block">
                <input id="contractType" type="hidden" name="contractType" class="layui-input input_gray"
                       readonly="readonly" lay-verify="required">
                <input id="contractTypeText" type="text" class="layui-input input_gray"
                       readonly="readonly" lay-verify="required">
            </div>
        </div>
        <!--合同年份-->
        <div class="layui-inline">
            <label class="layui-form-label">合同年份</label>
            <div class="layui-input-block">
                <input id="year" type="text" name="year" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
        </div>

    </div>


    <div class="layui-form-item">
        <!--月份-->
        <div class="layui-inline">
            <label class="layui-form-label">合同月份</label>
            <div class="layui-input-block">
                <input id="month" type="text" name="month" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
        </div>
        <!--签约人-->
        <div class="layui-inline">
            <label class="layui-form-label">签约人</label>
            <div class="layui-input-block">
                <input id="signatory" type="text" name="signatory" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
        </div>
        <!--签约时间-->
        <div class="layui-inline">
            <label class="layui-form-label">签约时间</label>
            <div class="layui-input-block">
                <input id="signingTime" type="text" name="signingTime" class="layui-input input_gray"
                       readonly="readonly" lay-verify="required">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <!--合同金额-->
        <div class="layui-inline">
            <label class="layui-form-label">合同金额</label>
            <div class="layui-input-block">
                <input id="conAmount" type="text" name="conAmount" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
            <span class="danwei">(元)</span>
        </div>
    </div>
    <div class="layui-form-item">
        <!--主要产品-->
        <div class="layui-block">
            <label class="layui-form-label">主要产品</label>
            <div class="layui-input-block" style="width: 786px;">
                <input id="mainProducts" type="text" name="mainProducts" class="layui-input input_gray"
                       readonly="readonly"
                       lay-verify="required">
            </div>
        </div>
    </div>

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>申请信息</legend>
    </fieldset>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">变更申请人</label>
            <div class="layui-input-block">
                <input id="applyUserId" name="applyUserId" type="hidden"/>
                <input id="applyUserName" type="text" name="applyUserName" class="layui-input input_gray"
                       readonly="readonly"
                       lay-verify="required">
            </div>
        </div>

        <!--变更申请时间-->
        <div class="layui-inline">
            <label class="layui-form-label">申请时间</label>
            <div class="layui-input-block">
                <input id="applyTime" type="text" name="applyTime" class="layui-input input_gray" readonly="readonly"
                       lay-verify="required">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <!--变更内容-->
        <div class="layui-block">
            <label class="layui-form-label">变更内容</label>
            <div class="layui-input-block" style="width: 786px;">
                <textarea name="applyContent" class="layui-textarea" lay-verify="required"
                          readonly="readonly"></textarea>
            </div>
        </div>
    </div>

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>审核信息</legend>
    </fieldset>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">审核状态</label>
            <input type="radio" name="checkState" value="002" title="同意" checked="">
            <input type="radio" name="checkState" value="003" title="不同意">
        </div>
    </div>
    <div class="layui-form-item">
        <!--变更内容-->
        <div class="layui-block">
            <label class="layui-form-label">审核意见</label>
            <div class="layui-input-block" style="width: 786px;">
                <textarea name="checkResult" id="checkResult" class="layui-textarea" placeholder="请填写审核意见！"
                          lay-verify="required"></textarea>
            </div>
        </div>
    </div>
    <div class="layui-form-item model-form-footer">
        <button class="layui-btn layui-btn-primary" ew-event="closeDialog" type="button">关闭</button>
        </button>
        <button class="layui-btn" id="change_apply_agree_submit" lay-filter="change_apply_agree_submit" lay-submit>保存
        </button>
    </div>


</form>
<script>
    layui.use(['layer', 'admin', 'config', 'form', 'config', 'formSelects', 'laydate'], function () {
        var layer = layui.layer,
            layer = layui.layer,
            admin = layui.admin,
            form = layui.form,
            formSelects = layui.formSelects,
            laydate = layui.laydate,
            config = layui.config;
        // 回显数据
        var changeApplyInfo = admin.getTempData('contract_apply_info');
        form.val('contract_change_check_form', changeApplyInfo);
        //处理合同类型显示
        if ('001' == changeApplyInfo.contractType) {
            $('#contractTypeText').val('销售合同');
        } else {
            $('#contractTypeText').val('采购合同');
        }
        //渲染单选按钮
        form.render('radio');

        //获取合同信息并赋值
        function contractInfo() {
            console.log(changeApplyInfo.contractId+'=====================================');
            console.log(changeApplyInfo);
            var contractType=changeApplyInfo.contractType;
            console.log(contractType+'!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
            var url = ""; 
            //构造参数字符串
            var jsonParam = { contractNumber: changeApplyInfo.contractId, isChange: '001'};
            if ('001' ==contractType) {
                url = "/contract/salesContract/getDetail";
            } else {
                url = "/contract/purchaseContract/getDetail";
            }

            console.log(url);
            //异步请求数据并赋值表单
            admin.req(url, jsonParam, function (data) {
                layer.closeAll('loading');
                if (data != null) {
                    $('#contractId').val(data.contractNumber);
                    $('#year').val(data.year);
                    $('#month').val(data.month);
                    $('#signatory').val(data.signatory);
                    $('#signingTime').val(data.signingTime);
                    $('#conAmount').val(data.conAmount);
                    $('#mainProducts').val(data.mainProducts);
                }
            }, 'GET');
        }

        contractInfo();
        //清空审核内容
        $('#checkResult').val('');
        form.val("contract_change_check_form", {
            "checkState": "002"
        })
        //渲染表单
        form.render();

        // 表单提交事件
        form.on('submit(change_apply_agree_submit)', function (data) {
            form.render();
            layer.load(2);
            admin.req('/contract/changeApply/verify', data.field, function (resData) {
                //var dataObj = JSON.parse(resData);
                layer.closeAll('loading');
                layer.msg("操作成功！", {icon: 1});
                admin.finishPopupCenter();
            }, 'PUT');
            return false;
        });
    })
    ;
</script>