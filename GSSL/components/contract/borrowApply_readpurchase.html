<!-- purch查看表单弹窗 -->
<link rel="stylesheet" type="text/css" href="/assets/css/custom/common.css"/>
<link rel="stylesheet" type="text/css" href="/assets/css/custom/editTable.css"/>

<style type="text/css">

    .layui-form-label {
        width: 126px;
    }
    .layui-input-block {
        margin-left: 157px;
    }

    .ht_right .layui-form-item .layui-inline .layui-input-block {
        width: 150px!important;
    }
    .mingxi {
        margin: 0 30px;
    }
    .invoice {
        margin: 0 30px;
    }
    .back {
        margin: 0 30px;
    }
    .minxi {
        height: 300px;
        overflow-y: auto;
        border: 1px solid #eee;
        margin: 10px auto;
    }
    .mxtable {
        display: none;
    }
    .tit span {
        margin-right: 10px;
        cursor: pointer;
        height: 34px;
        line-height: 34px;
    }
    .tit span.active {
        color: #009688;
    }
    textarea{width:820px;}
</style>
<form id="borrow-readpurchase-form" lay-filter="borrow-readpurchase-form" class="layui-form model-form look_bg">
    <input name="id" id="id" type="hidden" />
    <div class="layui-form-item">
        <!--contractNumber-->
        <div class="layui-inline">
            <label class="layui-form-label">合同编号：</label>
            <div class="layui-input-block">
                <input name="contractNumber" id="contractNumber" placeholder="请输入合同编号" type="text" class="layui-input" maxlength="30" readonly="readonly" lay-verify="required" />
            </div>
        </div>
        <!--signatory-->
        <div class="layui-inline">
            <label class="layui-form-label">签约人：</label>
            <div class="layui-input-block">
                <input name="signatory" placeholder="请输入签约人" type="text" class="layui-input" readonly="readonly" lay-verify="required" />
            </div>
        </div>
        <!--signingDate-->
        <div class="layui-inline">
            <label class="layui-form-label">签约时间：</label>
            <div class="layui-input-block">
                <input name="signingDate" id="signingDate" placeholder="请选择签约时间" type="text" class="layui-input time_item" maxlength="20"disabled="disabled" lay-verify="required" />
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <!--conAmount-->
        <div class="layui-inline">
            <label class="layui-form-label">合同金额(元)：</label>
            <div class="layui-input-block">
                <input name="conAmount" placeholder="请输入合同金额" type="text" class="layui-input" maxlength="20" readonly="readonly"  lay-verify="required" />
            </div>
        </div>
        <!--termPayment-->
        <div class="layui-inline">
            <label class="layui-form-label">付款条件：</label>
            <div class="layui-input-block">
                <select name="termPayment" id="termPayment" disabled="disabled" class="layui-select"></select>
            </div>
        </div>
        <!--mentType-->
        <div class="layui-inline">
            <label class="layui-form-label">运输方式：</label>
            <div class="layui-input-block">
                <select name="mentType" id="mentType" class="layui-select" disabled="disabled"></select>
            </div>
        </div>

    </div>
    <div class="layui-form-item">
        <!--product-->
        <div class="layui-inline">
            <label class="layui-form-label">主要产品：</label>
            <div class="layui-input-block" style="width: 505px;">
                <input name="product" placeholder="请输入主要产品"readonly="readonly"  type="text" class="layui-input" maxlength="20" lay-verify="required" />
            </div>
        </div>
        <!--arrivalDate-->
        <div class="layui-inline">
            <label class="layui-form-label">到货时间：</label>
            <div class="layui-input-block">
                <input name="arrivalDate" id="arrivalDate" disabled="disabled" placeholder="请选择到货时间" type="text" class="layui-input time_item" maxlength="20" lay-verify="required" />
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <!--arrivalPlace-->
        <div class="layui-inline">
            <label class="layui-form-label">到货地点：</label>
            <div class="layui-input-block">
                <input name="arrivalPlace" placeholder="请输入到货地点"readonly="readonly"  type="text" class="layui-input" maxlength="20" lay-verify="required" />
            </div>
        </div>
        <!--supplierId-->
        <div class="layui-inline">
            <label class="layui-form-label">供应商：</label>
            <div class="layui-input-block" style="width: 505px;">
                <select name="supplierId" id="supplierId" lay-filter="supplierId" disabled="disabled" lay-verify=""></select>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <!--name-->
        <div class="layui-inline">
            <label class="layui-form-label">供应商联系人：</label>
            <div class="layui-input-block">
                <input id="name" placeholder="请输入联系人名称" readonly="readonly" type="text" class="layui-input" maxlength="20" lay-verify="" />
            </div>
        </div>
        <!--clientTel-->
        <div class="layui-inline">
            <label class="layui-form-label">供应商电话：</label>
            <div class="layui-input-block">
                <input name="clientTel" id="clientTel" placeholder="请输入用户名" type="text" readonly="readonly" class="layui-input" maxlength="20" lay-verify="" />
            </div>
        </div>
        <!--clientFax-->
        <div class="layui-inline">
            <label class="layui-form-label">供应商传真：</label>
            <div class="layui-input-block">
                <input name="clientFax" id="clientFax" placeholder="请输入用户名" type="text" readonly="readonly" class="layui-input" maxlength="20" lay-verify="" />
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <!--remark-->
        <div class="layui-block">
            <label class="layui-form-label">备注：</label>
            <div class="layui-input-block">
                <textarea name="remark" rows="2" cols=""readonly="readonly"  placeholder="请输入备注"></textarea>
            </div>
        </div>
    </div>

    <!--采购合同明细开始-->
    <div class="mingxi">
        <div class="ht_table" style="width: 100%;">
            <div class="tit clearfix" id="tit" style="text-align: right">
                <span style="float: left;">采购明细</span>
            </div>
            <div id="mx-form" >
                <table class="edtitable" id="edtitable" style="width: 100%;">
                    <tbody>
                    <tr>
                        <th>序号</th>
                        <th>名称</th>
                        <th>型号</th>
                        <th>单位</th>
                        <th>单价</th>
                        <th>数量</th>
                        <th>总价</th>
                        <th>备注</th>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!--采购合同明细结束-->

    <div class="layui-form-item model-form-footer" style="text-align: center;margin: 40px 0;">
        <button class="layui-btn layui-btn-primary" ew-event="closeDialog" type="button">关闭</button>
    </div>
</form>

<script>
    layui.use(['layer', 'admin','table','config', 'form', 'formSelects','laydate'], function () {
        var layer = layui.layer;
        var admin = layui.admin;
        var config = layui.config;
        var form = layui.form;
        var table = layui.table;
        var formSelects = layui.formSelects;
        var laydate = layui.laydate;
        //日期选择器
        lay('.time_item').each(function(){
            laydate.render({
                elem: this
                ,trigger: 'click'
                ,value: new Date()
                ,done: function(value, date){}
            });
        });

        //通过合同编号获取数据并写入表单
        function writeFormData() {
            var contractNumber = admin.getTempData("contractNumber");
            console.log(contractNumber);
            var url = '/contract/purchaseContract/getDetail';
            admin.req(url
                , {contractNumber: contractNumber, isChange: '001'}
                , function (data) {
                    form.val('borrow-readpurchase-form', data);
                    //付款条件
                    payTerms('/sys/dictData/list/term_payment','termPayment',data.termPayment);
                    //运输方式
                    payTerms('/sys/dictData/list/ment_type','mentType',data.mentType);
                    //客户渲染
                     customer();
                    //采购明细
                    purchDetail(data.id);
                }, 'GET');
        }

        //付款条件和运输方式
        function payTerms(url,id,parameter) {
            //付款条件
            admin.req(url, {}, function (data) {
                layer.closeAll('loading');
                // 渲染下拉框
                var electData = "<option value='请选择'></option>";
                for (var i in data) {
                    electData += "<option value='" + data[i].dictValue + "'>" + data[i].dictLabel + "</option>";
                }
                $('#'+id+'').html(electData);
                for (var i in data) {
                    console.log(i);
                    console.log(parameter);
                    if (data[i].dictValue == parameter)
                        $("option[value=" + data[i].dictValue + "]").attr("selected", "selected");
                }
                form.render('select');
            }, 'GET');
        }
        writeFormData();
        form.render('select');

        //供应商下拉框渲染选中
        function customer() {
            admin.req("/user/clientInfo/clientList", {}, function (data) {
                layer.closeAll('loading');
                // 渲染下拉框
                var electData = "<option value='请选择'></option>";
                for (var i in data) {
                    electData += "<option value='" + data[i].id + "'>" + data[i].clientName + "</option>";
                }
                $('#supplierId').html(electData);
                for (var i in data) {
                    $("option[value=" + data[i].id + "]").attr("selected", "selected");
                }
                form.render('select');

            }, 'GET');
        }

        //客户信息，名称，电话，传真在页面渲染
        function client(id) {
            admin.req("/user/clientInfo/getById/" + id, {}, function (data) {
                layer.closeAll('loading');
                // 渲染下拉框
                if(data != undefined && data != null && data != ''){
                    $("#name").val(data.name);
                    $("#clientTel").val(data.clientTel);
                    $("#clientFax").val(data.clientFax);
                }
            }, 'GET');
        }
        //采购合同明细
        function purchDetail(id) {
            admin.req("/contract/purchaseDetail/list/" + id, {}, function (data) {
                layer.closeAll('loading');
                var html = "";
                for (var i in data) {
                    html += "<tr class='detail'>";
                    html += "<td><input class='edit' readonly='readonly' lay-verify='required' type='text' value='" + data[i].orderNum + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' lay-verify='required' onfocus='chan()' type='text' value='" + data[i].name + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' lay-verify='required' type='text' value='" + data[i].mode + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' lay-verify='required' type='text' value='" + data[i].unit + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' id='price' lay-verify='required|number' type='text' value='" + data[i].price + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' id='sum'   lay-verify='required|number' type='text' value='" + data[i].sum + "'/></td>";
                    html += "<td><input class='edit' type='text' id='totalPrice' readonly='readonly' value='" + data[i].totalPrice + "'/></td>";
                    html += "<td><input class='edit' readonly='readonly' lay-verify='required' type='text' value='" + data[i].remark + "'/></td>";
                    html += "</tr>";
                }
                $("#edtitable").append(html);
            }, 'GET');
        }

    });

</script>